import React, { useState } from 'react';
import { FileUpload } from './components/FileUpload';
import { VulnerabilityScanner } from './components/VulnerabilityScanner';
import { ContractDeployment } from './components/ContractDeployment';
import { ProductTimeline } from './components/ProductTimeline';
import { ContractVerifier } from './components/ContractVerifier';
import type { VulnerabilityResult, ContractData, ProductTracker } from './types';
import { Shield } from 'lucide-react';

function App() {
  const [vulnerabilities, setVulnerabilities] = useState<VulnerabilityResult[]>([]);
  const [contractData, setContractData] = useState<ContractData | null>(null);
  const [productData, setProductData] = useState<ProductTracker>({
    id: '123',
    status: 'IN_TRANSIT',
    timestamp: new Date().toISOString(),
    contractHash: 'mock-hash-123',
  });

  const handleFileUpload = async (file: File) => {
    // Mock vulnerability check
    const mockResults: VulnerabilityResult[] = [
      {
        lineNumber: 42,
        issue: 'Reentrancy Vulnerability',
        suggestion: 'Use ReentrancyGuard or check-effects-interaction pattern',
        severity: 'HIGH',
      },
      {
        lineNumber: 87,
        issue: 'Integer Overflow',
        suggestion: 'Use SafeMath library or Solidity 0.8+ built-in checks',
        severity: 'MEDIUM',
      },
      {
        lineNumber: 156,
        issue: 'Uninitialized Storage Pointer',
        suggestion: 'Initialize all storage pointers explicitly',
        severity: 'LOW',
      },
    ];

    setVulnerabilities(mockResults);

    // Mock contract deployment
    const mockContract: ContractData = {
      address: '0x742d35Cc6634C0532925a3b844Bc454e4438f44e',
      hash: '0xf7eec66d3f0c79d6c4976bc7f3c55a5d5c1d8f37c35631b3feb4aa1a1542ea5d',
      deployedAt: new Date().toLocaleString(),
    };

    setContractData(mockContract);
  };

  return (
    <div className="min-h-screen bg-gray-50">
      <header className="bg-white shadow-sm">
        <div className="max-w-7xl mx-auto px-4 py-4 sm:px-6 lg:px-8">
          <div className="flex items-center gap-2">
            <Shield className="w-8 h-8 text-blue-600" />
            <h1 className="text-2xl font-bold text-gray-900">
              SupplyChainX Verifier
            </h1>
          </div>
        </div>
      </header>

      <main className="max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
        <div className="space-y-8">
          <section>
            <h2 className="text-lg font-medium text-gray-900 mb-4">
              Upload Smart Contract
            </h2>
            <FileUpload onFileSelect={handleFileUpload} />
          </section>

          {vulnerabilities.length > 0 && (
            <section>
              <VulnerabilityScanner results={vulnerabilities} />
            </section>
          )}

          {contractData && (
            <section>
              <ContractDeployment contract={contractData} />
            </section>
          )}

          <section className="bg-white rounded-lg shadow-md p-6">
            <h2 className="text-lg font-medium text-gray-900 mb-4">
              Product Tracking
            </h2>
            <ProductTimeline product={productData} />
          </section>

          {contractData && (
            <section>
              <ContractVerifier originalHash={contractData.hash} />
            </section>
          )}
        </div>
      </main>
    </div>
  );
}

export default App;